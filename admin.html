<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin panel ‚Äì Doch√°dzka</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  background: linear-gradient(135deg, #007bff, #6f42c1);
  color: #333;
  min-height: 100vh;
}
header {
  background: #fff;
  padding: 15px 25px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 10;
}
h1 {
  color: #007bff;
  margin: 0;
  font-size: 22px;
  font-weight: 600;
}
button {
  background: #007bff;
  border: none;
  color: white;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: 0.3s;
}
button:hover { background: #0056b3; }
nav {
  background: #fff;
  display: flex;
  justify-content: center;
  padding: 10px;
  gap: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  position: sticky;
  top: 70px;
  z-index: 5;
}
nav button {
  background: #007bff;
  color: white;
  padding: 8px 14px;
  border-radius: 8px;
  font-weight: 500;
}
nav button.active {
  background: #6f42c1;
}
section {
  display: none;
  padding: 25px;
  background: #fff;
  margin: 25px auto;
  border-radius: 12px;
  max-width: 1000px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}
section.active { display: block; }
h2 {
  color: #007bff;
  margin-top: 0;
  border-bottom: 2px solid #007bff;
  padding-bottom: 5px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  border-radius: 8px;
  overflow: hidden;
}
th, td {
  border: 1px solid #ddd;
  padding: 10px;
  text-align: left;
  font-size: 14px;
}
th {
  background: #007bff;
  color: white;
  font-weight: 500;
}
tr:nth-child(even) { background: #f8f9fa; }
.loader {
  text-align: center;
  padding: 20px;
  color: #007bff;
  font-weight: bold;
}
td button {
  background: #28a745;
  font-size: 13px;
}
td button:hover {
  background: #1e7e34;
}
.export-btn {
  margin-top: 15px;
  background: #28a745;
}
.export-btn:hover {
  background: #1e7e34;
}

/* ü™ü Modal */
.modal {
  display: none;
  position: fixed;
  z-index: 50;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.5);
}
.modal-content {
  background: white;
  margin: 15% auto;
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  text-align: center;
}
.modal-content h3 { color: #007bff; }
.modal-content input {
  width: 80%;
  padding: 8px;
  margin: 10px 0;
  border: 1px solid #ccc;
  border-radius: 6px;
}
</style>
</head>
<body>

<header>
  <h1>Admin panel ‚Äì Doch√°dzkov√Ω syst√©m</h1>
  <button id="logoutBtn">Odhl√°si≈• sa</button>
</header>

<nav>
  <button data-target="dochadzka" class="active">Doch√°dzka</button>
  <button data-target="prest√°vky">Prest√°vky</button>
  <button data-target="pn">PN</button>
  <button data-target="pouzivatelia">Pou≈æ√≠vatelia</button>
  <button data-target="novi">Nov√≠ zamestnanci</button>
</nav>

<section id="dochadzka" class="active">
  <h2>Doch√°dzka</h2>
  <button class="export-btn" onclick="exportTable('dochadzkaTable')">Exportova≈• do CSV</button>
  <div id="dochadzkaTable" class="loader">Naƒç√≠tavam d√°ta...</div>
</section>

<section id="prest√°vky">
  <h2>Prest√°vky</h2>
  <button class="export-btn" onclick="exportTable('prest√°vkyTable')">Exportova≈• do CSV</button>
  <div id="prest√°vkyTable" class="loader">Naƒç√≠tavam d√°ta...</div>
</section>

<section id="pn">
  <h2>PN</h2>
  <button class="export-btn" onclick="exportTable('pnTable')">Exportova≈• do CSV</button>
  <div id="pnTable" class="loader">Naƒç√≠tavam d√°ta...</div>
</section>

<section id="pouzivatelia">
  <h2>Pou≈æ√≠vatelia</h2>
  <div id="usersTable" class="loader">Naƒç√≠tavam pou≈æ√≠vateƒæov...</div>
</section>

<section id="novi">
  <h2>Nov√≠ zamestnanci</h2>
  <div id="newUsersTable" class="loader">Sledujem nov√© ƒçipy...</div>
</section>

<!-- ü™ü MODAL -->
<div id="assignModal" class="modal">
  <div class="modal-content">
    <h3>Priradi≈• meno</h3>
    <p id="modalUidText"></p>
    <input type="text" id="assignNameInput" placeholder="Zadajte meno">
    <br>
    <button id="saveAssignBtn">Ulo≈æi≈•</button>
    <button id="cancelAssignBtn" style="background:#dc3545;">Zru≈°i≈•</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onValue, remove, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB5ovJ-_GAnfIExgBsNuQtc4tb6mqhsdj8",
  authDomain: "dochadzkaesp32.firebaseapp.com",
  databaseURL: "https://dochadzkaesp32-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "dochadzkaesp32",
  storageBucket: "dochadzkaesp32.firebasestorage.app",
  messagingSenderId: "417668021105",
  appId: "1:417668021105:web:7fa3e144892d8b304854d0"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// üß≠ Prep√≠nanie sekci√≠
document.querySelectorAll("nav button").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
    document.getElementById(btn.dataset.target).classList.add("active");
  });
});

// üÜï Nov√≠ zamestnanci
const newUsersContainer = document.getElementById("newUsersTable");
onValue(ref(db, "newChips"), snapshot => {
  if (!snapshot.exists()) {
    newUsersContainer.innerHTML = "<p>≈Ωiadne nov√© ƒçipy.</p>";
    return;
  }

  let data = Object.entries(snapshot.val());
  // üî¢ Triedenie podƒæa timestamp, ak existuje
  data.sort((a, b) => (b[1].timestamp || 0) - (a[1].timestamp || 0));

  let html = "<table><tr><th>UID</th><th>ƒåas pr√≠chodu</th><th>Akcie</th></tr>";
  data.forEach(([uid, val]) => {
    const cas = val.timestamp ? new Date(val.timestamp).toLocaleString("sk-SK") : "-";
    html += `<tr><td>${uid}</td><td>${cas}</td><td><button onclick="openAssignModal('${uid}')">Priradi≈• meno</button></td></tr>`;
  });
  html += "</table>";
  newUsersContainer.innerHTML = html;
});

// ü™ü MODAL LOGIKA
const modal = document.getElementById("assignModal");
const modalUidText = document.getElementById("modalUidText");
const assignInput = document.getElementById("assignNameInput");
let currentUid = "";

window.openAssignModal = (uid) => {
  currentUid = uid;
  modalUidText.textContent = "UID: " + uid;
  assignInput.value = "";
  modal.style.display = "block";
};

document.getElementById("cancelAssignBtn").onclick = () => {
  modal.style.display = "none";
};

// üíæ Ulo≈æi≈• nov√© meno (s valid√°ciou + error handling)
document.getElementById("saveAssignBtn").onclick = async () => {
  const name = assignInput.value.trim();
  if (!name || !/^[\p{L}\d\s]+$/u.test(name)) {
    alert("Zadajte platn√© meno (len p√≠smen√°, ƒç√≠sla alebo medzery).");
    return;
  }

  try {
    await set(ref(db, "users/" + currentUid), { name, chipUid: currentUid });
    await remove(ref(db, "newChips/" + currentUid));
    alert("Zamestnanec " + name + " bol pridan√Ω.");
    modal.style.display = "none";
  } catch (err) {
    console.error(err);
    alert("‚ùå Chyba pri ukladan√≠: " + err.message);
  }
};
</script>
</body>
</html>










